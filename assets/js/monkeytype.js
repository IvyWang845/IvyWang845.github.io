function test(){$("#resultScreenshot").removeClass("hidden"),html2canvas($("#resultScreenshot"),{onclone:function(e){e.getElementById("resultScreenshot").style.display="block"}}).then(e=>{$("#resultScreenshot").removeClass("hidden"),document.body.appendChild(e)})}function setFocus(e){e?($("#top").addClass("focus"),$("#bottom").addClass("focus"),$("body").css("cursor","none")):(startCaretAnimation(),$("#top").removeClass("focus"),$("#bottom").removeClass("focus"),$("body").css("cursor","default"))}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function initWords(){if(testActive=!1,wordsList=[],currentWordIndex=0,missedChars=0,inputHistory=[],currentInput="","time"==testMode){let e=words[Math.floor(Math.random()*words.length)];punctuationMode?wordsList.push(capitalizeFirstLetter(e)):wordsList.push(e);for(let t=1;t<50;t++){for(e=words[Math.floor(Math.random()*words.length)],previousWord=wordsList[t-1];e==previousWord.replace(".","").replace(",","").replace("'","").replace(":","");)e=words[Math.floor(Math.random()*words.length)];punctuationMode&&("."==previousWord.charAt(previousWord.length-1)?e=capitalizeFirstLetter(e):Math.random()<.1&&"."!=previousWord.charAt(previousWord.length-1)||t==wordsConfig-1?e+=".":Math.random()<.01?e="'"+e+"'":Math.random()<.01?e+=":":Math.random()<.01&&","!=previousWord.charAt(previousWord.length-1)&&"."!=previousWord.charAt(previousWord.length-1)&&"-"!=previousWord?e="-":Math.random()<.2&&","!=previousWord.charAt(previousWord.length-1)&&(e+=",")),wordsList.push(e)}}else if("words"==testMode){let e=words[Math.floor(Math.random()*words.length)];punctuationMode?wordsList.push(capitalizeFirstLetter(e)):wordsList.push(e);for(let t=1;t<wordsConfig;t++){for(e=words[Math.floor(Math.random()*words.length)],previousWord=wordsList[t-1];e==previousWord.replace(".","").replace(",","").replace("'","").replace(":","");)e=words[Math.floor(Math.random()*words.length)];punctuationMode&&("."==previousWord.charAt(previousWord.length-1)?e=capitalizeFirstLetter(e):Math.random()<.1&&"."!=previousWord.charAt(previousWord.length-1)||t==wordsConfig-1?e+=".":Math.random()<.01?e="'"+e+"'":Math.random()<.01?e+=":":Math.random()<.01&&","!=previousWord.charAt(previousWord.length-1)&&"."!=previousWord.charAt(previousWord.length-1)&&"-"!=previousWord?e="-":Math.random()<.2&&","!=previousWord.charAt(previousWord.length-1)&&(e+=",")),wordsList.push(e)}}else if("custom"==testMode){let e=customText.split(" ");for(let t=0;t<e.length;t++)wordsList.push(e[t])}showWords()}function addWord(){let e=words[Math.floor(Math.random()*words.length)];wordsList.push(e);let t="<div class='word'>";for(let o=0;o<e.length;o++)t+="<letter>"+e.charAt(o)+"</letter>";t+="</div>",$("#words").append(t)}function showWords(){if($("#words").empty(),"words"==testMode||"custom"==testMode)for(let e=0;e<wordsList.length;e++){let t="<div class='word'>";for(let o=0;o<wordsList[e].length;o++)t+="<letter>"+wordsList[e].charAt(o)+"</letter>";t+="</div>",$("#words").append(t)}else if("time"==testMode){$("#words").css("height","78px").css("overflow","hidden");for(let e=0;e<wordsList.length;e++){let t="<div class='word'>";for(let o=0;o<wordsList[e].length;o++)t+="<letter>"+wordsList[e].charAt(o)+"</letter>";t+="</div>",$("#words").append(t)}}updateActiveElement(),updateCaretPosition()}function updateActiveElement(){$("#words .word").removeClass("active"),$($("#words .word")[currentWordIndex]).addClass("active").removeClass("error")}function highlightMissedLetters(){let e=wordsList[currentWordIndex];$(".word.active letter").addClass("incorrect");for(let t=0;t<currentInput.length;t++)e[t]==currentInput[t]&&$($(".word.active letter")[t]).removeClass("incorrect").addClass("correct")}function highlightBadWord(){$(".word.active").addClass("error")}function hideMissedLetters(){let e=wordsList[currentWordIndex];$(".word.active letter").addClass("missing");for(let t=0;t<currentInput.length;t++)e[t]==currentInput[t]&&$($(".word.active letter")[t]).removeClass("missing").addClass("incorrect")}function hideCaret(){$("#caret").addClass("hidden")}function showCaret(){$("#caret").removeClass("hidden"),startCaretAnimation()}function stopCaretAnimation(){$("#caret").css("animation-name","none"),$("#caret").css("background-color","var(--caret-color)")}function startCaretAnimation(){$("#caret").css("animation-name","caretFlash")}function showTimer(){$("#timerWrapper").css("opacity",1)}function hideTimer(){$("#timerWrapper").css("opacity",0)}function updateCaretPosition(){let e=$("#caret"),t=($("#words .word.active"),currentInput.length),o=t-1;-1==o&&(o=0);let n=$($("#words .word.active letter")[o]),r=n.position(),s=n.height();0==t?e.css({top:r.top-s/4,left:r.left-e.width()/2}):e.css({top:r.top-s/4,left:r.left+n.width()-e.width()/2})}function calculateStats(){if("words"==testMode&&inputHistory.length!=wordsList.length)return;let e=0,t=0,o=0;for(let o=0;o<inputHistory.length;o++){t+=wordsList[o].length+1,e++;for(let t=0;t<wordsList[o].length;t++)try{inputHistory[o][t]==wordsList[o][t]?e++:0}catch(i){0}inputHistory[o].length<wordsList[o].length&&(missedChars+=wordsList[o].length-inputHistory[o].length)}e--,o=--t/inputHistory.length,o=5;let n=0;"time"==testMode?n=e*(60/timeConfig)/o:"words"!=testMode&&"custom"!=testMode||(n=e*(60/((testEnd-testStart)/1e3))/o);let r=(t-missedChars)/t*100,s=e+"/"+(t-e);return{wpm:Math.round(n),acc:r,key:s}}function liveWPM(){let e=Date.now(),t=Math.round((e-testStart)/1e3),o=0;for(let e=0;e<inputHistory.length;e++){for(let t=0;t<wordsList[e].length;t++)try{inputHistory[e][t]==wordsList[e][t]&&o++}catch(n){}o++}wpm=o*(60/t)/5,wpm>0&&(0==$("#liveWpm").css("opacity")&&$("#liveWpm").css("opacity",.25),wpm<100?($("#liveWpm").html("&nbsp;"+Math.round(wpm).toString()),$("#liveWpm").css("margin-left","-3rem")):($("#liveWpm").text(Math.round(wpm)),$("#liveWpm").css("margin-left",0)))}function showResult(){testEnd=Date.now();let e=calculateStats();return $("#top .result .wpm .val").text(e.wpm),$("#top .result .acc .val").text(Math.round(e.acc)+"%"),$("#top .result .key .val").text(e.key),$("#top .result .testmode .mode1").text(testMode),"time"==testMode?$("#top .result .testmode .mode2").text(timeConfig):"words"==testMode&&$("#top .result .testmode .mode2").text(wordsConfig),punctuationMode?$("#top .result .testmode .mode3").text("punc."):$("#top .result .testmode .mode3").text(""),testActive=!1,$("#top .config").addClass("hidden"),$("#top .result").removeClass("hidden").animate({opacity:1},0,()=>{setFocus(!1)}),$("#top #liveWpm").css("opacity",0),hideCaret(),e}function addToLeaderboard(e,t){var o=findRank(e);if(0!=o){var n=prompt("Enter your name in the leaderboard!");null!==n&&addPlayer(o,n,e,t)}}function getWPM(){var e=window.prompt("Enter your wpm");return e}function getPlayerName(){do{return playername=window.prompt("Enter your name in the leaderboard! Or press Cancel to decline entering your score."),playername}while(!playername)}function findRank(e){var t=document.querySelector("#leaderboard").querySelectorAll("tr");for(i=1;i<t.length;i++){if(t[i].querySelectorAll("td")[2].textContent<e)return i}return i}function addPlayer(e,t,o,n){var r=document.getElementById("leaderboard"),s=r.insertRow(e),i=s.insertCell(0),d=s.insertCell(1),a=s.insertCell(2),c=s.insertCell(3);i.innerHTML=e,d.innerHTML=t,a.innerHTML=o,c.innerHTML=n,updateRankings(r,e)}function updateRankings(e,t){var o=e.querySelectorAll("tr");for(i=t+1;i<o.length;i++){o[i].querySelectorAll("td")[0].textContent=i}}function updateTimer(){liveWPM();let e=(time-1)/timeConfig*100;$("#timer").stop(!0,!0).css("width",100-e+"vw")}function restartTest(){let e=$("#words").height(),t=!$("#top .result").hasClass("hidden");$("#top .result").css("opacity","1").css("transition","none").stop(!0,!0).animate({opacity:0},250,()=>{$("#top .result").addClass("hidden").css("transition","0.25s"),(testActive||t)&&$("#top .config").css("opacity","0").removeClass("hidden").css("transition","none").stop(!0,!0).animate({opacity:1},250,()=>{$("#top .config").css("transition","0.25s")})}),setFocus(!1),$("#liveWpm").css("opacity",0),$("#wordsInput").focus(),initWords(),testActive=!1,startCaretAnimation(),"time"==testMode&&(setTimeout(function(){$("#timer").css("transition","none").css("width","0vw").animate({top:0},0,()=>{$("#timer").css("transition","1s linear")})},250),clearInterval(timer),timer=null,time=timeConfig);let o=$("#words").css("height","fit-content").css("height","-moz-fit-content").height();"words"==testMode||"custom"==testMode?$("#words").stop(!0,!0).css("height",e).animate({height:o},250,()=>{$("#words").css("height","fit-content").css("height","-moz-fit-content"),updateCaretPosition()}):"time"==testMode&&$("#words").stop(!0,!0).css("height",e).animate({height:78},250,()=>{updateCaretPosition()})}function changeCustomText(){customText=prompt("Custom text"),initWords()}function timesUp(){hideCaret(),testActive=!1;var e=showResult();addToLeaderboard(e.wpm,Math.round(e.acc))}function compareInput(){$(".word.active").empty();let e="",t=wordsList[currentWordIndex];$($("#words .word")[currentWordIndex]).children("letter");for(let o=0;o<currentInput.length;o++)t[o]==currentInput[o]?e+='<letter class="correct">'+t[o]+"</letter>":t[o]==undefined?e+='<letter class="incorrect extra">'+currentInput[o]+"</letter>":e+='<letter class="incorrect">'+t[o]+"</letter>";if(currentInput.length<t.length)for(let o=currentInput.length;o<t.length;o++)e+="<letter>"+t[o]+"</letter>";if(t==currentInput&&currentWordIndex==wordsList.length-1){inputHistory.push(currentInput),currentInput="";var o=showResult();addToLeaderboard(o.wpm,Math.round(o.acc))}$(".word.active").html(e)}function changeWordCount(e){changeMode("words"),wordsConfig=parseInt(e),$("#top .config .wordCount .button").removeClass("active"),$("#top .config .wordCount .button[wordCount='"+e+"']").addClass("active"),restartTest()}function changeTimeConfig(e){changeMode("time"),timeConfig=e,$("#top .config .time .button").removeClass("active"),$("#top .config .time .button[timeConfig='"+e+"']").addClass("active"),restartTest()}function togglePunctuation(){punctuationMode?$("#top .config .punctuationMode .button").removeClass("active"):$("#top .config .punctuationMode .button").addClass("active"),punctuationMode=!punctuationMode,restartTest()}function changeMode(e){testMode=e,$("#top .config .mode .button").removeClass("active"),$("#top .config .mode .button[mode='"+e+"']").addClass("active"),"time"==testMode?($("#top .config .wordCount").addClass("hidden"),$("#top .config .time").removeClass("hidden"),$("#top .config .customText").addClass("hidden"),$("#top .config .punctuationMode").removeClass("hidden")):"words"==testMode?($("#top .config .wordCount").removeClass("hidden"),$("#top .config .time").addClass("hidden"),$("#top .config .customText").addClass("hidden"),$("#top .config .punctuationMode").removeClass("hidden")):"custom"==testMode&&($("#top .config .wordCount").addClass("hidden"),$("#top .config .time").addClass("hidden"),$("#top .config .customText").removeClass("hidden"),$("#top .config .punctuationMode").addClass("hidden")),restartTest()}function hideCommandLine(){$("#commandLineWrapper").stop(!0,!0).css("opacity",1).animate({opacity:0},100,()=>{$("#commandLineWrapper").addClass("hidden")}),$("#wordsInput").focus()}function showCommandLine(){$("#commandLineWrapper").hasClass("hidden")&&$("#commandLineWrapper").stop(!0,!0).css("opacity",0).removeClass("hidden").animate({opacity:1},100),$("#commandLine input").val(""),updateSuggestedCommands(),$("#commandLine input").focus()}function updateSuggestedCommands(){let e=$("#commandLine input").val().toLowerCase().split(" ");""==e[0]?$.each(currentCommands.list,(e,t)=>{t.found=!0}):$.each(currentCommands.list,(t,o)=>{let n=0;$.each(e,(e,t)=>{if(""==t)return;let r=new RegExp(t,"g"),s=o.display.toLowerCase().match(r);null!=s&&s.length>0?n++:n--}),o.found=n>0}),displayFoundCommands()}function displayFoundCommands(){$("#commandLine .suggestions").empty(),$.each(currentCommands.list,(e,t)=>{t.found&&$("#commandLine .suggestions").append('<div class="entry" command="'+t.id+'">'+t.display+"</div>")}),0==$("#commandLine .suggestions .entry").length?$("#commandLine .separator").css({height:0,margin:0}):$("#commandLine .separator").css({height:"1px","margin-bottom":".5rem"});let e=$("#commandLine .suggestions .entry");e.length>0&&$(e[0]).addClass("active"),$("#commandLine .listTitle").remove()}var words=["the","be","of","and","a","to","in","he","have","it","that","for","they","I","with","as","not","on","she","at","by","this","we","you","do","but","from","or","which","one","would","all","will","there","say","who","make","when","can","more","if","no","man","out","other","so","what","time","up","go","about","than","into","could","state","only","new","year","some","take","come","these","know","see","use","get","like","then","first","any","work","now","may","such","give","over","think","most","even","find","day","also","after","way","many","must","look","before","great","back","through","long","where","much","should","well","people","down","own","just","because","good","each","those","feel","seem","how","high","too","place","little","world","very","still","nation","hand","old","life","tell","write","become","here","show","house","both","between","need","mean","call","develop","under","last","right","move","thing","general","school","never","same","another","begin","while","number","part","turn","real","leave","might","want","point","form","off","child","few","small","since","against","ask","late","home","interest","large","person","end","open","public","follow","during","present","without","again","hold","govern","around","possible","head","consider","word","program","problem","however","lead","system","set","order","eye","plan","run","keep","face","fact","group","play","stand","increase","early","course","change","help","line"];let testStart,testEnd,wordsList=[],currentWordIndex=0,inputHistory=[],currentInput="",wordsConfig=100,timeConfig=30,time=timeConfig,timer=null,testActive=!1,testMode="time",missedChars=0,punctuationMode=!1,customText="The quick brown fox jumped over the lazy dog";restartTest(),$(document).ready(()=>{$("#centerContent").css("opacity","0").removeClass("hidden"),$("#centerContent").stop(!0,!0).animate({opacity:1},250,()=>{updateCaretPosition()})}),$(document).on("click","#top .config .wordCount .button",e=>{wrd=e.currentTarget.innerHTML,changeWordCount(wrd)}),$(document).on("click","#top .config .time .button",e=>{changeTimeConfig(time=e.currentTarget.innerHTML)}),$(document).on("click","#top .config .customText .button",()=>{changeCustomText()}),$(document).on("click","#top .config .punctuationMode .button",()=>{togglePunctuation()}),$(document).on("click","#top .config .mode .button",e=>{$(e.currentTarget).hasClass("active")||(mode=e.currentTarget.innerHTML,changeMode(mode))}),$("#restartTestButton").keypress(e=>{32!=e.keyCode&&13!=e.keyCode||(restartTest(),$("#wordsInput").focus())}),$("#restartTestButton").click(()=>{restartTest()}),$("#wordsInput").keypress(e=>{e.preventDefault()}),$("#words").click(()=>{$("#wordsInput").focus()}),$("#wordsInput").on("focus",()=>{showCaret()}),$("#wordsInput").on("focusout",()=>{hideCaret()}),$(document).keypress(function(e){if($("#wordsInput").is(":focus")&&13!=e.keyCode&&32!=e.keyCode){if(""==currentInput&&0==inputHistory.length)testActive=!0,stopCaretAnimation(),testStart=Date.now(),"time"==testMode&&(showTimer(),updateTimer(),timer=setInterval(function(){time--,updateTimer(),0==time&&(clearInterval(timer),timesUp())},1e3));else if(!testActive)return;wordsList[currentWordIndex].substring(currentInput.length,currentInput.length+1)!=e.key&&missedChars++,currentInput+=e.key,setFocus(!0),compareInput(),updateCaretPosition()}}),$(window).resize(()=>{updateCaretPosition()}),$(document).mousemove(function(){setFocus(!1)}),$(document).keydown(e=>{if(27==e.keyCode&&($("#commandLineWrapper").hasClass("hidden")?(currentCommands=commands,showCommandLine()):hideCommandLine()),$("#wordsInput").is(":focus")){if(8==e.keyCode){if(e.preventDefault(),!testActive)return;if(""==currentInput&&inputHistory.length>0){if(inputHistory[currentWordIndex-1]==wordsList[currentWordIndex-1]||$($(".word")[currentWordIndex-1]).hasClass("hidden"))return;e.ctrlKey||e.altKey?(currentInput="",inputHistory.pop()):currentInput=inputHistory.pop(),currentWordIndex--,updateActiveElement(),compareInput()}else currentInput=e.ctrlKey?"":currentInput.substring(0,currentInput.length-1),compareInput();updateCaretPosition()}if(32==e.keyCode){if(!testActive)return;if(e.preventDefault(),""==currentInput)return;let o=wordsList[currentWordIndex];if("time"==testMode){let e=$($("#words .word")[currentWordIndex]).position().top;if($($("#words .word")[currentWordIndex+1]).position().top>e)for(let e=0;e<currentWordIndex+1;e++)$($("#words .word")[e]).addClass("hidden")}if(o==currentInput)inputHistory.push(currentInput),currentInput="",currentWordIndex++,updateActiveElement(),updateCaretPosition();else{if(inputHistory.push(currentInput),highlightBadWord(),currentInput="",++currentWordIndex==wordsList.length){var t=showResult();return void addToLeaderboard(t.wpm,Math.round(t.acc))}updateActiveElement(),updateCaretPosition()}"time"==testMode&&addWord()}}});let commands={title:"",list:[{id:"togglePunctuation",display:"Toggle punctuation",exec:()=>togglePunctuation()},{id:"changeMode",display:"Change mode...",subgroup:!0,exec:()=>{currentCommands=commandsMode,showCommandLine()}},{id:"changeTimeConfig",display:"Change time config...",subgroup:!0,exec:()=>{currentCommands=commandsTimeConfig,showCommandLine()}},{id:"changeWordCount",display:"Change word count...",subgroup:!0,exec:()=>{currentCommands=commandsWordCount,showCommandLine()}}]},commandsWordCount={title:"Change word count...",list:[{id:"changeWordCount10",display:"10",exec:()=>changeWordCount("10")},{id:"changeWordCount25",display:"25",exec:()=>changeWordCount("25")},{id:"changeWordCount50",display:"50",exec:()=>changeWordCount("50")},{id:"changeWordCount100",display:"100",exec:()=>changeWordCount("100")},{id:"changeWordCount200",display:"200",exec:()=>changeWordCount("200")}]},commandsMode={title:"Change mode...",list:[{id:"changeModeTime",display:"time",exec:()=>changeMode("time")},{id:"changeModeWords",display:"words",exec:()=>changeMode("words")},{id:"changeModeCustom",display:"custom",exec:()=>changeMode("custom")}]},commandsTimeConfig={title:"Change time config...",list:[{id:"changeTimeConfig15",display:"15",exec:()=>changeTimeConfig("15")},{id:"changeTimeConfig30",display:"30",exec:()=>changeTimeConfig("30")},{id:"changeTimeConfig60",display:"60",exec:()=>changeTimeConfig("60")},{id:"changeTimeConfig120",display:"120",exec:()=>changeTimeConfig("120")}]},currentCommands=commands;$("#commandLine input").keydown(e=>{if(13==e.keyCode){e.preventDefault();let t=$(".suggestions .entry.active").attr("command"),o=!1;return $.each(currentCommands.list,(e,n)=>{n.id==t&&(n.exec(),o=n.subgroup)}),void(o||hideCommandLine())}if(38==e.keyCode||40==e.keyCode){let t=$(".suggestions .entry"),o=-1;return $.each(t,(e,t)=>{$(t).hasClass("active")&&(o=e)}),38==e.keyCode&&(t.removeClass("active"),0==o?$(t[t.length-1]).addClass("active"):$(t[--o]).addClass("active")),40==e.keyCode&&(t.removeClass("active"),o+1==t.length?$(t[0]).addClass("active"):$(t[++o]).addClass("active")),!1}}),$("#commandLine input").keyup(e=>{38!=e.keyCode&&40!=e.keyCode&&updateSuggestedCommands()});